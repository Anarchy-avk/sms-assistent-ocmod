<?xml version="1.0" encoding="UTF-8"?>
<modification>
    <name>SMS-Assistent Module</name>
    <version>1.6</version>
    <author>SMS-Assistent</author>
    <code>jEl5MZAg0hBiza34T6XHuJr5dvJ1tnXq</code>

    <file path="system/startup.php">
        <operation>
            <search><![CDATA[
                // Engine
            ]]></search>
            <add position="after"><![CDATA[
require_once(DIR_SYSTEM . 'library/smsassistent.php');
            ]]></add>
        </operation>
    </file>

    <file path="catalog/model/checkout/order.php">
        <operation>
            <search><![CDATA[
                // If order status is not 0 then send update text email
            ]]></search>
            <add position="after"><![CDATA[
            if ($this->config->get('smsassistent_ms_status') == '1') {
                if ($this->config->get("smsassistent_naco_customer_status_$order_status_id") == '1') {
                    $sms = new SMSAssistent($this->config, $this->db);
                    $orderProductQuery = $this->db->query("SELECT * FROM " . DB_PREFIX . "order_product WHERE order_id = '" . (int)$order_id . "'");
                    $sms->nacoCustomerNotification($order_info, (int)$order_status_id, $orderProductQuery, $this->currency);
                }
                if ($this->config->get("smsassistent_naco_admin_status_$order_status_id") == '1') {
                    $sms = new SMSAssistent($this->config, $this->db);
                    $orderProductQuery = $this->db->query("SELECT * FROM " . DB_PREFIX . "order_product WHERE order_id = '" . (int)$order_id . "'");
                    $sms->nacoAdminNotification($order_info, (int)$order_status_id, $orderProductQuery, $this->currency);
                }
            }
            ]]></add>
        </operation>
    </file>

    <file path="catalog/model/account/customer.php">
        <operation>
            <search><![CDATA[
                // Send to main admin email if new account email is enabled
            ]]></search>
            <add position="after"><![CDATA[
        if ($this->config->get('smsassistent_ms_status') == "1") {
            if ($this->config->get('smsassistent_narc_customer_status') == "1") {
                $sms = new SMSAssistent($this->config, $this->db);
                $sms->narcCustomerNotification($customer_id, $data);
            }
            if ($this->config->get('smsassistent_narc_admin_status') == "1") {
                $sms = new SMSAssistent($this->config, $this->db);
                $sms->narcAdminNotification($customer_id, $data);
            }
        }
            ]]></add>
        </operation>
    </file>

    <file path="admin/model/sale/orderproh.php">
        <operation>
            <search><![CDATA[
                $order_history_id = $this->db->getLastId();
            ]]></search>
            <add position="after"><![CDATA[
            if ($this->config->get('smsassistent_ms_status') == '1') {
                if ($this->config->get("smsassistent_naco_customer_status_$new_status_id") == '1') {
                    $sms = new SMSAssistent($this->config, $this->db);
                    $orderProductQuery = $this->db->query("SELECT * FROM " . DB_PREFIX . "order_product WHERE order_id = '" . (int)$order_id . "'");
                    $sms->nacoCustomerNotification($order_info, (int)$new_status_id, $orderProductQuery, $this->currency);
                }
                if ($this->config->get("smsassistent_naco_admin_status_$new_status_id") == '1') {
                    $sms = new SMSAssistent($this->config, $this->db);
                    $orderProductQuery = $this->db->query("SELECT * FROM " . DB_PREFIX . "order_product WHERE order_id = '" . (int)$order_id . "'");
                    $sms->nacoAdminNotification($order_info, (int)$new_status_id, $orderProductQuery, $this->currency);
                }
            }
            ]]></add>
        </operation>
    </file>
</modification>